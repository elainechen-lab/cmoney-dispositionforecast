<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>CMoney ËôïÁΩÆËÇ°È†êÊ∏¨</title>

  <style>
    :root{
      --bg:#fde8e6;
      --bg2:#f8d7d1;
      --panel:#ffffffcc;
      --panel2:#ffffffee;
      --text:#1f2937;
      --muted:#6b7280;
      --line:rgba(31,41,55,.12);
      --shadow:0 16px 45px rgba(31,41,55,.12);
      --radius:16px;

      --brand:#8b0c0c;
      --brand2:#b91c1c;
      --chip:#6b0b0b;

      --warnRow:#ffe2c4;
      --card:#ffffff;
      --cardLine:rgba(31,41,55,.10);

      --ok:#16a34a;
      --no:#9ca3af;

      --accordionBg:#fff7f5;
      --noteBg:#fff3ef;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Arial, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 10% 0%, #ffd4cf, transparent 60%),
        radial-gradient(900px 500px at 90% 15%, #ffd6c7, transparent 60%),
        linear-gradient(180deg, var(--bg), #fff);
      min-height:100vh;
    }

    .wrap{
      max-width: 1280px;
      margin: 0 auto;
      padding: 14px 14px 32px;
    }

    /* ===== Top header ===== */
    .topbar{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      padding: 8px 2px 12px;
    }
    .brand{
      display:flex; align-items:baseline; gap:10px; flex-wrap:wrap;
    }
    .brand .logo{
      font-weight: 900;
      letter-spacing: .5px;
      font-size: 34px;
      color: var(--brand2);
    }
    .brand .title{
      font-weight: 900;
      letter-spacing: .3px;
      font-size: 22px;
      color: #111827;
    }
    .meta{
      display:flex;
      flex-direction:column;
      gap:6px;
      text-align:right;
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .meta .pill{
      display:inline-flex;
      align-items:center;
      justify-content:flex-end;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background: #ffffffcc;
      border:1px solid var(--line);
      box-shadow: 0 10px 22px rgba(31,41,55,.08);
    }

    /* ===== Tabs ===== */
    .tabs{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      padding: 8px 0 16px;
    }
    .tab{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(139,12,12,.18);
      background: linear-gradient(180deg, #7a0b0b, #5d0707);
      color:#fff;
      box-shadow: 0 10px 24px rgba(139,12,12,.18);
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, filter .12s ease;
    }
    .tab:hover{ transform: translateY(-1px); filter: brightness(1.03); }
    .tab.active{
      background: linear-gradient(180deg, #ffffff, #fff7f6);
      color:#111827;
      border:1px solid rgba(31,41,55,.18);
      box-shadow: 0 10px 24px rgba(31,41,55,.10);
    }
    .tab .ico{
      width:22px; height:22px;
      display:grid; place-items:center;
      border-radius: 8px;
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.18);
      font-size:13px;
    }
    .tab.active .ico{
      background: rgba(185,28,28,.10);
      border-color: rgba(185,28,28,.18);
    }
    .tab .label{
      font-weight: 800;
      font-size: 13px;
      letter-spacing: .2px;
    }
    .tab .count{
      margin-left: 4px;
      font-weight: 900;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.18);
      white-space:nowrap;
    }
    .tab.active .count{
      background: rgba(31,41,55,.06);
      border-color: rgba(31,41,55,.10);
    }

    /* ===== Panel ===== */
    .panel{
      background: var(--panel2);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panelHd{
      padding: 14px 16px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, #ffd2cd, #ffe6e2);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .panelHd .h{
      font-weight: 900;
      letter-spacing: .2px;
      font-size: 16px;
    }
    .panelHd .rightBadge{
      font-size:12px;
      font-weight:900;
      padding: 6px 10px;
      border-radius: 10px;
      background:#ffffffcc;
      border: 1px solid var(--line);
      white-space:nowrap;
    }

    .panelBody{
      padding: 12px;
    }

    /* ===== Generic table (other tabs keep table) ===== */
    .tableWrap{ overflow:auto; }
    table{
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 980px;
      font-size: 13px;
      background:#fff;
      border:1px solid var(--cardLine);
      border-radius: 14px;
      overflow:hidden;
    }
    thead th{
      position: sticky;
      top: 0;
      background: #fff1ee;
      border-bottom: 1px solid var(--cardLine);
      color:#111827;
      text-align:left;
      padding: 10px 10px;
      font-weight: 900;
      z-index: 1;
    }
    tbody td{
      padding: 10px 10px;
      border-bottom: 1px solid rgba(31,41,55,.08);
      vertical-align: top;
    }
    tbody tr:last-child td{ border-bottom: 0; }
    tbody tr.warn td{ background: var(--warnRow); }
    .center{ text-align:center; }

    /* ===== Up/Down: Accordion cards ===== */
    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    details.acc{
      border: 1px solid var(--cardLine);
      border-radius: 14px;
      overflow:hidden;
      background: #fff;
      box-shadow: 0 10px 22px rgba(31,41,55,.08);
    }
    details.acc[open]{
      background: var(--accordionBg);
    }

    summary.accSum{
      list-style:none;
      cursor:pointer;
      user-select:none;
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: #fff;
    }
    summary.accSum::-webkit-details-marker{ display:none; }

    .accGrid{
      display:grid;
      grid-template-columns: 80px 1.4fr 110px 120px 110px 120px;
      gap:8px;
      align-items:center;
      width:100%;
      min-width: 0;
    }
    .gCode{ font-weight: 900; }
    .gName{
      color:#111827;
      font-weight: 800;
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .gMuted{ color: var(--muted); font-weight: 800; font-size:12px; }
    .gNum{ font-weight: 900; }
    .gLoop{
      font-weight: 900;
      padding: 6px 10px;
      border-radius: 10px;
      border:1px solid rgba(31,41,55,.10);
      background: rgba(31,41,55,.03);
      display:inline-flex;
      justify-content:center;
      white-space:nowrap;
    }
    .gLoop.warn{
      border-color: rgba(245,158,11,.35);
      background: rgba(245,158,11,.16);
    }

    .chips{
      display:flex;
      gap:8px;
      justify-content:flex-end;
      align-items:center;
    }
    .chip{
      width:28px; height:28px;
      border-radius:999px;
      display:grid; place-items:center;
      font-weight: 900;
      font-size: 12px;
      border: 2px solid var(--no);
      color: var(--no);
      background: #f3f4f6;
    }
    .chip.on{
      border-color: var(--ok);
      color: var(--ok);
      background: #eafff1;
    }

    .chev{
      width:34px;
      display:flex;
      justify-content:flex-end;
      color: rgba(31,41,55,.55);
      font-size: 16px;
      font-weight: 900;
      transition: transform .12s ease;
    }
    details.acc[open] .chev{ transform: rotate(90deg); }

    /* expanded */
    .accBody{
      border-top: 1px solid rgba(31,41,55,.10);
      padding: 12px 12px 14px;
      background: var(--noteBg);
      font-size: 13px;
      line-height: 1.65;
    }
    .noteTitle{
      font-weight: 900;
      margin-bottom: 6px;
    }
    .noteStrong{ font-weight: 900; }
    .noteBlock{ margin-top: 6px; white-space: pre-wrap; }

    /* non-expandable item (no note) */
    .plainCard{
      border: 1px solid var(--cardLine);
      border-radius: 14px;
      overflow:hidden;
      background: #fff;
      box-shadow: 0 10px 22px rgba(31,41,55,.08);
      padding: 10px 12px;
    }

    /* ===== Responsive ===== */
    @media (max-width: 980px){
      table{ min-width: 860px; }
      .accGrid{
        grid-template-columns: 74px 1fr 92px 92px;
      }
      .hideMd{ display:none; }
    }

    @media (max-width: 640px){
      .brand .logo{ font-size: 28px; }
      .brand .title{ font-size: 18px; }
      .panelBody{ padding: 10px; }

      /* mobile keeps ‚Äúboard‚Äù feel: summary becomes stacked */
      summary.accSum{ padding: 10px 10px; }
      .accGrid{
        grid-template-columns: 68px 1fr;
        grid-auto-rows: auto;
        row-gap: 6px;
      }
      .mobileRow{
        grid-column: 1 / -1;
        display:flex;
        justify-content:space-between;
        gap:10px;
        align-items:center;
      }
      .chips{ justify-content:flex-start; }
      .chev{ width:auto; }
    }

    .loading{
      padding: 18px 12px;
      color: var(--muted);
      font-weight: 800;
      font-size: 13px;
    }
    .err{
      margin: 10px 0 0;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(185,28,28,.25);
      background: rgba(185,28,28,.08);
      color: #7f1d1d;
      font-weight: 800;
      font-size: 13px;
    }

    footer{
      margin-top: 16px;
      text-align:center;
      color: var(--muted);
      font-size: 12px;
      opacity: .9;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo">CMoney</div>
        <div class="title">ËôïÁΩÆËÇ°È†êÊ∏¨</div>
      </div>
      <div class="meta">
        <div class="pill">Êõ¥Êñ∞ÊôÇÈñìÔºö<span id="updatedAt">-</span></div>
      </div>
    </div>

    <div class="tabs" id="tabs"></div>

    <div class="panel">
      <div class="panelHd">
        <div class="h" id="panelTitle">ËºâÂÖ•‰∏≠‚Ä¶</div>
        <div class="rightBadge" id="panelBadge">‚Äî</div>
      </div>
      <div class="panelBody" id="panelBody">
        <div class="loading">ÈñãÂïüË≥áÊñô‰∏≠‚Ä¶</div>
      </div>
    </div>

    <footer>¬© CMoney. All rights reserved.</footer>
  </div>

  <script>
    // ===============================
    // ‚úÖ data.json Ë∑ØÂæë
    // ===============================
    const DATA_URL = "./data.json";

    // ===============================
    // Tabs configuration
    // ===============================
    const PANELS = [
      { key: "soonRelease", title: "Âç≥Â∞áÂá∫Èóú", icon:"‚è≥" },
      { key: "disposed",    title: "ËôïÁΩÆ‰∏≠",   icon:"‚õìÔ∏è" },
      { key: "up",          title: "Êº≤N%ÈÄ≤ËôïÁΩÆ", icon:"üìà" },
      { key: "down",        title: "Ë∑åN%ÈÄ≤ËôïÁΩÆ", icon:"üìâ" },
      { key: "fastestN",    title: "ÊúÄÂø´NÊó•ÈÄ≤ËôïÁΩÆ", icon:"‚ö°" },
    ];

    // ‰Ω†ÊåáÂÆöË¶ÅÂº∑Âà∂ÊèíÂÖ•ÁöÑÊ¢ùÊ¨æÊñáÂ≠óÔºàÁ≤óÈ´îÔºâ
    const CLAUSE_LINE = "ËôïÁΩÆËÇ°Á•®Ê¢ùÊ¨æ‰∏≠ÊúâÈ°ûËÇ°Áõ∏ÈóúÊ¢ùÊ¨æÔºöÂÖ∂ÂÖ≠Êó•Êº≤Ë∑åÁôæÂàÜÊØîËàáÂÖ®È´îÊúâÂÉπË≠âÂà∏ÂèäÂêåÈ°ûÊúâÂÉπË≠âÂà∏‰æùÊú¨È†ÖË¶èÂÆöË®àÁÆó‰πãÂπ≥ÂùáÂÄºÁöÑÂ∑ÆÂπÖÂùáÂú®ÁôæÂàÜ‰πã‰∫åÂçÅ‰ª•‰∏äÔºåÊâçÁ¨¶ÂêàÊ¢ùÊ¨æ„ÄÇ";

    let gPayload = null;
    let gActiveKey = PANELS[0].key;

    // ===============================
    // Helpers
    // ===============================
    const esc = (s) => {
      if (s === null || s === undefined) return "";
      return String(s)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    };

    const isEmpty = (v) => v === null || v === undefined || String(v).trim() === "";

    const br = (s) => esc(s).replaceAll("\n", "<br>");

    const pick = (row, keys, fallback="") => {
      for (const k of keys){
        if (row && Object.prototype.hasOwnProperty.call(row, k) && !isEmpty(row[k])) return row[k];
      }
      return fallback;
    };

    // ===== Common columns (try multiple aliases to be robust) =====
    const getCode = (r)=> pick(r, ["ËÇ°Á•®‰ª£Ëôü","Ê®ôÁöÑ‰ª£Ëôü","‰ª£Ëôü","StockID","stockId","code"]);
    const getName = (r)=> pick(r, ["ËÇ°Á•®ÂêçÁ®±","Ê®ôÁöÑÂêçÁ®±","ÂêçÁ®±","StockName","stockName","name"]);

    const getTriggerPrice = (r)=> pick(r, ["Ëß∏ÁôºÂÉπÊ†º","Ëß∏ÁôºÂÉπ","ÂÉπÊ†º","Price","price"]);
    const getTriggerPct   = (r)=> pick(r, ["Ëß∏ÁôºÊº≤Ë∑åÂπÖ(%)","Ëß∏ÁôºÊº≤Ë∑åÂπÖ%","Ëß∏ÁôºÊº≤Ë∑åÂπÖ","Êº≤Ë∑åÂπÖ(%)","Êº≤Ë∑åÂπÖ","Pct","pct"]);
    const getLoop         = (r)=> pick(r, ["Âæ™Áí∞ÊôÇÈñì(ÂàÜ)","Âæ™Áí∞ÊôÇÈñì","Âæ™Áí∞ÊôÇÈñì(ÂàÜÈêò)","loop","Loop"]);

    // ‰Ω†ÁöÑË≥á/Âà∏Ê¨Ñ‰ΩçÔºöÂèØËÉΩÊòØ 1/0„ÄÅY/N„ÄÅtrue/false„ÄÅÊàñÁõ¥Êé•ÊúâÂ≠ó
    const getMargin = (r)=> pick(r, ["Ë≥á","ÂèØË≥á","ËûçË≥á","Margin","margin"]);
    const getShort  = (r)=> pick(r, ["Âà∏","ÂèØÂà∏","ËûçÂà∏","Short","short"]);

    const asBool = (v)=>{
      if (isEmpty(v)) return false;
      const s = String(v).trim().toLowerCase();
      if (s === "1" || s === "y" || s === "yes" || s === "true" || s === "t") return true;
      if (s === "0" || s === "n" || s === "no" || s === "false" || s === "f") return false;
      // Ëã•Áõ¥Êé•ÊòØ "Ë≥á" / "Âà∏" ÊàñÂÖ∂‰ªñÊñáÂ≠óÔºå‰πüË¶ñÁÇ∫ true
      return true;
    };

    // Êñ∞Ë™™ÊòéÊ¨Ñ‰Ωç
    const getText1 = (r)=> pick(r, ["ÊñáÂ≠óÂÖßÂÆπ1","ÊñáÂ≠ó1","ÂÖßÂÆπ1","Text1","text1"]);
    const getText2 = (r)=> pick(r, ["ÊñáÂ≠óÂÖßÂÆπ2","ÊñáÂ≠ó2","ÂÖßÂÆπ2","Text2","text2"]);
    const getExtra = (r)=> pick(r, ["Ë£úÂÖÖË™™Êòé","Ë£úÂÖÖ","Extra","extra","Note","note"]);

    // ===============================
    // Render Tabs
    // ===============================
    function renderTabs(){
      const tabs = document.getElementById("tabs");
      tabs.innerHTML = "";

      for (const p of PANELS){
        const cnt = (gPayload?.data?.[p.key]?.rows || []).length;

        const el = document.createElement("div");
        el.className = "tab" + (p.key === gActiveKey ? " active" : "");
        el.innerHTML = `
          <div class="ico">${esc(p.icon)}</div>
          <div class="label">${esc(p.title)}</div>
          <div class="count">ÂÖ±${cnt}Ê™î</div>
        `;
        el.onclick = ()=> {
          gActiveKey = p.key;
          renderTabs();
          showPanel(p.key);
        };
        tabs.appendChild(el);
      }
    }

    // ===============================
    // Generic Table (other panels)
    // ===============================
    function renderTable(pack){
      const headers = pack?.headers || [];
      const rows = pack?.rows || [];

      if (!headers.length) return `<div class="loading">Ê≤íÊúâË≥áÊñô</div>`;

      const th = headers.map(h => `<th>${esc(h)}</th>`).join("");
      const body = rows.map(r => {
        const loop = getLoop(r);
        const warn = (!isEmpty(loop) && Number(loop) >= 20) ? "warn" : "";
        const tds = headers.map(h => {
          const v = Object.prototype.hasOwnProperty.call(r, h) ? r[h] : "";
          const isNum = (typeof v === "number") || String(v).match(/^[-]?\d+(\.\d+)?$/);
          return `<td class="${isNum ? "center" : ""}">${esc(v)}</td>`;
        }).join("");
        return `<tr class="${warn}">${tds}</tr>`;
      }).join("");

      return `
        <div class="tableWrap">
          <table>
            <thead><tr>${th}</tr></thead>
            <tbody>${body}</tbody>
          </table>
        </div>
      `;
    }

    // ===============================
    // Up/Down Accordion Cards (your requested style)
    // ===============================
    function renderUpDownAccordion(pack){
      const rows = pack?.rows || [];
      if (!rows.length) return `<div class="loading">Ê≤íÊúâË≥áÊñô</div>`;

      const html = rows.map(r => {
        const code = getCode(r);
        const name = getName(r);

        const price = getTriggerPrice(r);
        const pct   = getTriggerPct(r);
        const loop  = getLoop(r);

        const m = asBool(getMargin(r));
        const s = asBool(getShort(r));

        const t1 = getText1(r);
        const t2 = getText2(r);
        const ex = getExtra(r);

        const hasNote = !(isEmpty(t1) && isEmpty(t2) && isEmpty(ex));

        const loopWarn = (!isEmpty(loop) && Number(loop) >= 20);

        // mobile extra row
        const mobileRow = `
          <div class="mobileRow">
            <div>
              <span class="gMuted">Ëß∏ÁôºÂÉπ</span>
              <span class="gNum">${esc(price)}</span>
              <span class="gMuted">ÔΩúÂπÖÂ∫¶</span>
              <span class="gNum">${esc(pct)}</span>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
              <span class="gLoop ${loopWarn ? "warn" : ""}">${esc(loop)} ÂàÜ</span>
              <div class="chips">
                <span class="chip ${m ? "on" : ""}">Ë≥á</span>
                <span class="chip ${s ? "on" : ""}">Âà∏</span>
              </div>
            </div>
          </div>
        `;

        const grid = `
          <div class="accGrid">
            <div>
              <div class="gMuted">‰ª£Ëôü</div>
              <div class="gCode">${esc(code)}</div>
            </div>
            <div style="min-width:0;">
              <div class="gMuted">ÂêçÁ®±</div>
              <div class="gName" title="${esc(name)}">${esc(name)}</div>
            </div>

            <div class="hideMd">
              <div class="gMuted">Ëß∏ÁôºÂÉπ</div>
              <div class="gNum">${esc(price)}</div>
            </div>
            <div class="hideMd">
              <div class="gMuted">Ëß∏ÁôºÂπÖÂ∫¶</div>
              <div class="gNum">${esc(pct)}</div>
            </div>

            <div class="hideMd" style="display:flex; flex-direction:column; gap:4px;">
              <div class="gMuted">Âæ™Áí∞(ÂàÜ)</div>
              <div class="gLoop ${loopWarn ? "warn" : ""}">${esc(loop)} ÂàÜ</div>
            </div>

            <div class="hideMd">
              <div class="gMuted">ËûçË≥á / ËûçÂà∏</div>
              <div class="chips" style="justify-content:flex-start; margin-top:6px;">
                <span class="chip ${m ? "on" : ""}">Ë≥á</span>
                <span class="chip ${s ? "on" : ""}">Âà∏</span>
              </div>
            </div>

            ${mobileRow}
          </div>
        `;

        const noteHtml = `
          <div class="accBody">
            <div class="noteTitle">„ÄêÊ≥®ÊÑè‰∫ãÈ†Ö„Äë</div>

            ${!isEmpty(t1) ? `<div class="noteBlock">${br(t1)}</div>` : ``}

            <div class="noteBlock noteStrong">**${esc(CLAUSE_LINE)}**</div>

            ${!isEmpty(t2) ? `<div class="noteBlock">${br(t2)}</div>` : ``}

            ${!isEmpty(ex) ? `<div class="noteBlock">${br(ex)}</div>` : ``}
          </div>
        `;

        // If no note => not expandable, keep card look but no accordion
        if (!hasNote){
          return `<div class="plainCard">${grid}</div>`;
        }

        return `
          <details class="acc">
            <summary class="accSum">
              ${grid}
              <div class="chev">‚Ä∫</div>
            </summary>
            ${noteHtml}
          </details>
        `;
      }).join("");

      return `<div class="list">${html}</div>`;
    }

    // ===============================
    // Show Panel
    // ===============================
    function showPanel(key){
      const titleEl = document.getElementById("panelTitle");
      const badgeEl = document.getElementById("panelBadge");
      const bodyEl  = document.getElementById("panelBody");

      const p = PANELS.find(x => x.key === key);
      titleEl.textContent = p ? p.title : key;

      const pack = gPayload?.data?.[key];
      const cnt = (pack?.rows || []).length;
      badgeEl.textContent = `ÂÖ±${cnt}Ê™î`;

      if (key === "up" || key === "down"){
        bodyEl.innerHTML = renderUpDownAccordion(pack);
      }else{
        bodyEl.innerHTML = renderTable(pack);
      }
    }

    // ===============================
    // Load Data
    // ===============================
    async function loadData(){
      const bodyEl = document.getElementById("panelBody");
      bodyEl.innerHTML = `<div class="loading">ÈñãÂïüË≥áÊñô‰∏≠‚Ä¶</div>`;

      try{
        const res = await fetch(`${DATA_URL}?t=${Date.now()}`, { cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const payload = await res.json();
        gPayload = payload;

        document.getElementById("updatedAt").textContent = payload.updatedAt || "-";

        renderTabs();
        showPanel(gActiveKey);

      }catch(err){
        bodyEl.innerHTML = `<div class="err">ËÆÄÂèñ data.json Â§±ÊïóÔºö${esc(err.message)}<br>Ë´ãÁ¢∫Ë™ç DATA_URL ÊòØÂê¶Ê≠£Á¢∫Ôºå‰ª•Âèä GitHub Pages ÊòØÂê¶Â∑≤Êõ¥Êñ∞„ÄÇ</div>`;
      }
    }

    loadData();
  </script>
</body>
</html>
